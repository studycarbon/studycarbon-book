# CH03 - 程序的数据类型

> 版本信息：2023/02/22 ---------- 第一个版本

数据类型是数据的一个类型，它告诉编译器或者解释器，该数据代表的具体含义。Carbon语言中支持整数，浮点数，字符和布尔等基本数据类型。由基本的数据类型可以组合复杂的数据类型，将在后续章节进行讲解。

## 布尔类型(bool)

一个布尔类型值只有两种：true和false。如下列语句就定义了一个bool类型变量并赋值为true。`bool` ,`true`和`false`都是关键字。 布尔值通常由比较表达式产生，控制语句中的条件参数通常采用bool值：如`if`和`while`以及`if-then-else`条件表达式。截止2023/02/22 此时，bool类型的使用还在讨论中。

## 数字类型

### 整数类型 (Integer types)

具有位宽N的有符号整数类型可以写为iN，只要N是8的正倍数。例如，i32是一个有符号的32位整数。有符号整数溢出是编程错误：

* 在开发构建中，溢出在运行时发生时将立即被捕获。
* 在性能构建中，优化器可以假设这种情况不会发生。因此，如果他们这样做，程序的行为就不会被定义。
* 在硬化的构建中，溢出不会导致未定义的行为。相反，要么程序将被中止，要么算法将计算出数学上不正确的结果，例如2的补码结果或零

无符号整数类型可以写成uN，N是8的正倍数。无符号整数类型在溢出时换行；我们强烈建议，除非需要这些语义，否则不要使用它们。这些类型用于位操作或模块运算，如哈希、密码学和PRNG用例中常见的。永远不能为负的值（如大小），但包装不合理的值应使用有符号整数类型。

iN和uN形式的标识符是类型文字，产生相应的类型。

并非所有位大小都支持所有操作。例如，由于LLVM限制，除法可能被限制为最多128位的整数。

下面给出一些常用的整数算数操作：

加法操作与减法操作

> var a : i32 = 1;
>
> var b : i32 = 2;
>
> var c : i32 = a + b;
>
> Print("c:{0}", c); // c = 3

> var a : i32 = 1;
>
> var b : i32 = 2;
>
> var c : i32 = a - b;
>
> Print("c:{0}", c);

#### 整数字面量(Integer literals)

* 12345（十进制）
* 0x1FE (十六进制)
* 0b1010(二进制)

下划线（_）可用作数字分隔符。数字文本区分大小写：0x、0b必须小写，而十六进制数字必须大写。整数文本从不包含。

与C++不同，文字没有后缀来表示其类型。相反，数字文本具有从其值派生的类型，并且可以隐式转换为可以表示该值的任何类型。

### 浮点数类型(Integer types)

Carbon中的浮点类型具有IEEE-754语义，使用舍入到最近舍入模式，并且不设置任何浮点异常状态。它们是用类型文字命名的，由f和位数组成，位数必须是8的倍数。这些类型始终可用：f16、f32和f64。根据平台的不同，也可以使用其他尺寸，例如f80、f128或f256。

Carbon还支持BFloat16格式，即“二进制32”IEEE-754格式浮点数的16位截断。

下面给出一些常用的浮点数算术操作，如下：

>var a : f32 = 1.0;
>
>var b : f32 = 2.0;
>
>var c : f32 = 3.0;

注：截止目前2023/02/22，  官方提供的Compiler Explorer (compiler-explorer.com)](https://carbon.compiler-explorer.com/)还不支持浮点数参与到编译中。详情可自己体验下。

![image-20230222181330096](./img/image-20230222181330096.png)

#### 浮点数字面量（Floating-point literals）

浮点类型和用户定义的类型可以从实数文本初始化。支持十进制和十六进制实数文本：

* 123.456 （数字位于"."的两边）
* 123.456e789 （e的后面可以是"+"或者是"-"）
* 0x1.Ap123 (p的后面可以是"+"或者是"-")

与整数文字一样，下划线（_）可以用作数字分隔符。实数文本始终有一个句点（.）和句点两边的数字。当实数文本被解释为浮点类型的值时，其值是最接近文本值的可表示实数。

## 字符类型

>注意：这是临时的，尚未通过提议过程来设计字符串类型。(摘录自carbon设计文档，参考资料含有设计文档地址)

这里有两种字符串类型：

* `String`:包含UTF-8编码文本的字节序列.
* `StringView`:包含UTF-8编码文本的字节序列的只读引用。

存在从String到StringView的隐式转换。

#### 字符串字面量

字符串文本可以在字符串的开头和结尾使用双引号（""）写在单行上，如:

>”hello"
>
>"example"

多行字符串文字（称为块字符串文字）以三个双引号（“”）开头和结尾，并且在第一个“”之后可能有一个文件类型指示符。如：

>```
>// Block string literal:
>var block: String = """
>    The winds grow high; so do your stomachs, lords.
>    How irksome is this music to my heart!
>    When such strings jar, what hope of harmony?
>    I pray, my lords, let me compound this strife.
>        -- History of Henry VI, Part II, Act II, Scene 1, W. Shakespeare
>    """;
>```

块字符串文本终止行的缩进将从所有前面的行中删除。

字符串可能包含带反斜杠（\）的转义序列。原始字符串文本可用于表示带有“s”和“s”的字符串。

## 参考资料

carbon-lang的github官方设计文档：<https://github.com/carbon-language/carbon-lang/tree/trunk/docs/design>

## [CH03-复合数据类型](CH03-复合数据类型.md)
